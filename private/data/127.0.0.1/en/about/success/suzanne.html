<!doctype html>
<html lang="en">
  <head>
    
    <!-- about/success/suzanne -->
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <title>
      Python.org
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <!-- le html5 shim, for ie6-8 support of html elements -->
    <!--[if lt ie 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    <!-- le styles -->
    
    <script type="text/javascript"><!--
    // These variables are used by the web2py_ajax_init function in web2py_ajax.js (which is loaded below).
    var w2p_ajax_confirm_message = "Are you sure you want to delete this object?";
    var w2p_ajax_date_format = "%Y-%m-%d";
    var w2p_ajax_datetime_format = "%Y-%m-%d %H:%M:%S";
    //--></script>
<meta name="keywords" content="web2py, python, framework" /><meta name="copyright" content="Copyright 2011" /><meta name="description" content="a cool new app" /><meta name="generator" content="Web2py Web Framework" /><meta name="author" content="Your Name &lt;you@example.com&gt;" /><script src="/pythonorg/static/js/jquery.js" type="text/javascript"></script><link href="/pythonorg/static/css/calendar.css" rel="stylesheet" type="text/css" /><script src="/pythonorg/static/js/calendar.js" type="text/javascript"></script><script src="/pythonorg/static/js/web2py.js" type="text/javascript"></script><link href="/pythonorg/static/css/web2py.css" rel="stylesheet" type="text/css" /><script src="/pythonorg/static/bootswatch_files/jquery.toc.js" type="text/javascript"></script><link href="http://bootswatch.com/spacelab/bootstrap.min.css" rel="stylesheet" type="text/css" /><link href="http://bootswatch.com/assets/css/bootstrap-responsive.css" rel="stylesheet" type="text/css" /><link href="http://bootswatch.com/css/docs.css" rel="stylesheet" type="text/css" />

    <style>
#content {padding-top: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 12pt;
 font-weight: 300;line-height: 22.5px;color: #333;}
#content-main img {max-width:200px; padding: 10px;}
#toc { padding: 10px; font-size: 12px; font-height:14px}
#toc ul { margin: 0; padding: 0; list-style: none; }
#toc li { padding: 5px 10px; }
#toc a { text-decoration: none; display: block; }
#toc .toc-h2 { padding-left: 10px;}
#toc .toc-h3 { padding-left: 20px; }
#toc .toc-active { background: #ddd; }
p, li {text-align: justify; line-height: 22.5px;}
#content h1, #content h2, #content h3, #content h4 { 
  padding-top:1em; padding-bottom: 0.5em; 
}
#rst-content h1 {font-size: 28px; text-align: left}
#rst-content h2 {font-size: 24px; text-align: left}
#rst-content h3 {font-size: 20px; text-align: left}
#rst-content h4 {font-size: 16px; text-align: left}
#rst-content pre {background-color: black; border: 0; color:white}
</style>
  </head>
  <body data-spy="scroll" data-target=".subnav" data-offset="50">
    <!-- navbar     ================================================== -->
    <div class="navbar navbar-fixed-top">
      
      <div id="flash" class="flash navbar-inner" style="text-align:center; vertical-align:middle; background: yellow; color:black"></div>
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"> </span>
            <span class="icon-bar"> </span>
            <span class="icon-bar"> </span>
          </a>
          <!--a class="brand" href="http://bootswatch.com/">bootswatch</a-->
          <div class="nav-collapse">
	    <ul class="nav"><li><a href="/pythonorg/default/index">Python.org</a></li><li class="dropdown"><a href="#" onclick="javascript:void(0);return false;">About</a><ul class="dropdown-menu"><li><a href="/pythonorg/default/index/about">Readme</a></li><li><a href="/pythonorg/default/index/about/gettingstarted">Getting Started</a></li><li><a href="/pythonorg/default/index/about/apps">Applications</a></li><li><a href="/pythonorg/default/index/about/success">Success Stories</a></li><li><a href="http://docs.python.org/license.html">License</a></li><li><a href="/pythonorg/default/index/about/help">Help</a></li></ul></li><li class="dropdown"><a href="#" onclick="javascript:void(0);return false;">News</a><ul class="dropdown-menu"><li><a href="/pythonorg/default/index/news">Readme</a></li><li><a href="/pythonorg/default/index/news/security">Security Advisory</a></li><li><a href="/pythonorg/default/index/news/releaseschedule">Release Schedule</a></li></ul></li><li class="dropdown"><a href="#" onclick="javascript:void(0);return false;">Learn</a><ul class="dropdown-menu"><li><a href="https://www.google.com/search?q=python&amp;btnG=Search+Books&amp;tbm=bks&amp;tbo=1#q=python+language&amp;hl=en&amp;tbo=1&amp;tbas=0&amp;tbs=vw:g,bkt:b,cdr:1,cd_min:2000,cd_max:2099&amp;tbm=bks&amp;source=lnt&amp;sa=X">Books</a></li><li><a href="http://pyvideo.org">Videos</a></li><li><a href="http://wiki.python.org/moin/BeginnersGuide">Beginner's Tutorials</a></li><li><a href="http://docs.python.org/library/">Libraries</a></li><li><a href="http://docs.python.org/devguide/">Core Develoment</a></li><li><a href="http://wiki.python.org/moin/">Wiki</a></li><li><a href="/pythonorg/default/index/dev/peps">PEPs</a></li></ul></li><li class="dropdown"><a href="#" onclick="javascript:void(0);return false;">Download</a><ul class="dropdown-menu"><li><a href="/pythonorg/default/index/download/windows">For Windows</a></li><li><a href="/pythonorg/default/index/download/mac">For Mac</a></li><li><a href="/pythonorg/default/index/download/source">For Linux</a></li><li><a href="/pythonorg/default/index/download/other">For other OS</a></li><li><a href="/pythonorg/default/index/download/releases">Old Releases</a></li></ul></li><li class="dropdown"><a href="#" onclick="javascript:void(0);return false;">Community</a><ul class="dropdown-menu"><li><a href="/pythonorg/default/index/community">Readme</a></li><li><a href="/pythonorg/default/index/community/lists">Mailing Lists</a></li><li><a href="/pythonorg/default/index/community/sigs">User Groups</a></li><li><a href="/pythonorg/default/index/community/workshops">Conferences</a></li><li><a href="/pythonorg/default/index/community/jobs">Jobs</a></li><li><a href="/pythonorg/default/index/community/awards">Awards</a></li><li><a href="/pythonorg/default/index/community/merchandise">Merchanise</a></li></ul></li><li class="dropdown"><a href="#" onclick="javascript:void(0);return false;">PSF</a><ul class="dropdown-menu"><li><a href="/pythonorg/default/index/psf">Readme</a></li><li><a href="/pythonorg/default/index/psf/about">About the PSF</a></li><li><a href="/pythonorg/default/index/psf/summary">Executive Summary</a></li><li><a href="/pythonorg/default/index/psf/mission">Mission Statement</a></li><li><a href="/pythonorg/default/index/psf/membership">Membership</a></li><li><a href="/pythonorg/default/index/psf/volunteer">Volunteer</a></li><li><a href="/pythonorg/default/index/psf/league">League</a></li><li><a href="/pythonorg/default/index/psf/committees">Committees</a></li><li><a href="/pythonorg/default/index/psf/bylaws">ByLaws</a></li><li><a href="/pythonorg/default/index/psf/reports">Reports</a></li><li><a href="http://wiki.python.org/moin/PythonSoftwareFoundation">Wiki</a></li><li><a href="http://pyfound.blogspot.com/">Weblog</a></li><li><a href="http://python.org/psf/press-release/">Press Releases</a></li><li><a href="/pythonorg/default/index/psf/forms">Forms</a></li></ul></li></ul>
	    
            <ul class="nav pull-right">
              <li>
                <a href="/pythonorg/default/edit/about/success/suzanne">
                  [en] Edit
                  <i class="icon-share-alt icon-white"> </i>
                </a>
              </li>	      
            </ul>
	    
          </div>
        </div>
      </div>
    </div>
    <div class="container">
      <!-- masthead ================================================== -->
      <header class="jumbotron subhead" id="overview">
	<img src="/pythonorg/static/images/logo.png" width="86px" align="left"/>
        <h1>
          python<small>.org</small>
        </h1>
        <p class="lead">
          The Programming Language of the Future
        </p>
      </header>
      <!-- content ================================================== -->
      <section id="content">
        <div class="page-header">
          <!--h1>
            typography
          </h1-->
        </div>
        <!-- headings & paragraph copy -->
        <div class="row">
          <div class="span8" id="content-main">
	    
<div id="rst-content">
  
  <p><strong>MISSING</strong>
<strong>MISSING</strong></p>
<div class="section" id="suzanne-python-handles-critical-data-in-a-domain-name-landrush">
<h1>Suzanne: Python Handles Critical Data in a Domain Name Landrush</h1>
<p><strong>MISSING</strong>
<strong>MISSING</strong>
<strong>Category:</strong>  Business, Software Development</p>
<p><strong>Keywords:</strong>  High Availability, Testing, Ecommerce, Quality, Network Development</p>
<p><strong>Title:</strong>  Suzanne: Python Handles Critical Data in a Domain Name Landrush</p>
<p><strong>Author:</strong>   Stephane Bortzmeyer</p>
<p><strong>Date:</strong>   2004-05-29</p>
<p><strong>Website:</strong>  <a class="reference external" href="http://www.afnic.fr/">http://www.afnic.fr/</a></p>
<p><strong>Summary:</strong>  Python helps AFNIC manage over 10,000 internet domain name registration requests per minute in a landrush for the &quot;.fr&quot; top-level internet domain.</p>
<p><strong>Logo:</strong>  .. image:: /files/success/suzanne/afnic-logo.gif    :alt: /files/success/suzanne/afnic-logo.gif</p>
<div class="section" id="introduction">
<h2>Introduction</h2>
<p><a class="reference external" href="http://www.afnic.fr/">AFNIC</a> is the registry of the French <strong>.fr</strong> top-level internet domain. For
many years, registration rules in <strong>.fr</strong> were very strict. On May 11th, 2004,
<a class="reference external" href="http://www.afnic.fr/actu/nouvelles/nommage/CP20040120">the rules changed</a> to a more liberal model, allowing many registrations
that were not possible before. As a consequence of this change, the registry
was faced with receiving a potentially unmanageable burst of requests. This is
a problem known as a &quot;landrush&quot; faced by every DNS registry which changes its
rules or introduces a new service, like Unicode domain names.</p>
<p>Since the rule of registries is &quot;first come, first served&quot;, everybody wants to
have their submission arrive immediately after the new domain space is
available, in this case May 11th, 09:00, local time. In this context, some
domain names were requested by three different clients within the very same
second.</p>
<p>Machine crashes are a sad tradition at registries resulting in unexpected
delays, clients frantically hitting Submit while trying to send a completed
Web form, and bad press for the registry afterwards.</p>
<p>For a variety of reasons, this particular landrush was a technical success,
with zero crashes.  This article focuses on the role that Python played
in this success.</p>
</div>
<div class="section" id="buffering-the-requests">
<h2>Buffering the Requests</h2>
<p>The AFNIC registration system was written years ago, mostly in Perl. It
responds to registration requests, satisfies them, and then returns
confirmation to the web client, all in one synchronous request/response cycle.
Although this system works well during normal load, it simply cannot handle
the load of a landrush. Even more modern systems that are parallelized across
many machines will fail under the impossible load of a landrush, where web
requests from clients must be answered in a synchronous manner.</p>
<p>To avoid this bottleneck without attempting to rebuild the whole registration
system, AFNIC decided to place an asynchronous buffer between the client and
the main registration application. This buffer was not a full-fledged system,
it just received the requests, stored them in FIFO order, acknowledged them
and later handed them over to the real registration system within the limits
of its processing capacity.</p>
<p>This asynchronous buffer was written in Python and is named Suzanne, from the
novel <em>Un barrage contre le Pacifique</em> by Marguerite Duras, where the hero's
mother tries to protect her land from the waves of the Pacific ocean.</p>
<p>The requirements for Suzanne were simple: it had to be fast, robust, reliable,
and it had to work the first time around, because there was no second chance.
Protecting the data was extremely critical: while the big frenzy of domain
name speculation is over, many companies are still ready to spend a lot of
money for a domain name. If they miss the domain name they want because buggy
software dropped a request, the registry is faced with bad press at the
minimum, and possibly expensive litigation.</p>
</div>
<div class="section" id="why-python">
<h2>Why Python?</h2>
<p>AFNIC uses many programming languages (Perl, Java, PHP, PL/SQL, and Ruby) but
this was the first use of Python. Like Perl and Ruby, Python includes the
standard libraries that were required by this project. Python was chosen for
its readability and ease of use.</p>
</div>
<div class="section" id="implementation">
<h2>Implementation</h2>
<p>Most of the brutal load was handled by the Postfix mail system. All requests
were received by email, which is asynchronous and thus avoids the
above-mentioned limitations of synchronous processing. Suzanne was in charge of
rotating mailboxes to keep them at a manageable size, and emitting
acknowledgement emails. This process used Python's standard library modules
<strong>mailbox</strong>, <strong>email</strong>, and <strong>smtplib</strong>, and the <a class="reference external" href="http://www.cheetahtemplate.org/">Cheetah</a> templating system
was used to create the acknowledgement messages.</p>
<p>When dealing with critical data accessed by several programs, all running at
full speed under a heavy load, it is critical to to prevent hidden race
conditions. Since Python currently lacks a standard global locking module, the
<a class="reference external" href="http://rgruet.free.fr/glock.py">glock</a> module by Richard Gruet was used to lock the mailboxes.</p>
<p>Once messages had been processed and acknowledged, Suzanne had to send
requests to the real registration system. Since SOAP is the standard in-house
inter-application protocol, AFNIC created a Web service in Python, using <a class="reference external" href="http://pywebsvcs.sourceforge.net/zsi.html">ZSI</a>
and the standard library's <a class="reference external" href="http://www.python.org/doc/current/lib/module-BaseHTTPServer.html">BaseHTTPServer</a>. The SOAP client was the
registration system, running Perl.</p>
<p>This project used Python version 2.3 and various Unix platforms. Suzanne is
very small: Just 2290 lines of Python, including the testing programs and the
statistics programs.</p>
<p>Testing was the key to success in this application, which had to perform
flawlessly during its first production run. Many bugs were uncovered by
testing Suzanne under load, first in-house, with several machines sending as
many requests as possible, and later by volunteers sending requests from the
outside.</p>
</div>
<div class="section" id="problems-encountered">
<h2>Problems Encountered</h2>
<p>Some problems were encountered during the implementation.  Working with mail
boxes and email messages in Python is somewhat complicated by the many modules
in the standard library provided for this purpose.  For this application,
these modules were often too low-level, requiring somewhat more work that
was initially expected.</p>
<p>ZSI also caused some trouble, and was sometimes difficult to use. The authors
used <a class="reference external" href="http://sourceforge.net/project/showfiles.php?group_id=26590&amp;package_id=18246">SOAPpy</a> on other projects, which in hindsight may have been a better
choice. Some of these problems stem from the fact that SOAP is complicated and
difficult to deal with in general, and were not always the fault of Python or ZSI.</p>
</div>
<div class="section" id="successes">
<h2>Successes</h2>
<p>Nevertheless, development of the system was quite fast, the resulting code
is simple and readable, and the system performed well.</p>
<p>Suzanne was able to handle the required processing with acceptable system
load. Mail boxes were parsed and acknowledgements sent at a very satisfactory
rate. And best of all, nothing crashed during the landrush, even with 12,000
messages in the first minute, a result of the fact that many clients developed
custom programs to start submitting requests at exactly 09:00.</p>
<p>Suzanne performed so well that AFNIC is considering making it a permanent part
of its infrastructure. If this is done, every request would go through
Suzanne, allowing the registration system to work at its own pace regardless
of unexpected peaks in future request activity.</p>
</div>
<div class="section" id="about-the-author">
<h2>About the Author</h2>
<p><em>Stephane Bortzmeyer &lt;;bortzmeyer&#64;nic.fr&gt; is network and systems architect at
AFNIC. He has worked for many Internet companies, from network operators to
Web agencies, and developed software in Perl, Ada and C before adopting
Python as well.</em></p>
</div>
</div>

  <br/><br/>
</div>
<script>
  jQuery(function(){
    jQuery('.system-message').hide();
    jQuery('#rst-content p').each(function(i){
      if(jQuery(this).html().lastIndexOf('Published:',0)===0)
        jQuery(this).css('text-align','right').css('color','#aaa');
    });
  });
</script>


          </div>
	  
          <div class="span4">
	    <form class="well form-search" action="/pythonorg/default/search">
              <input type="text" name="keywords" class="input-medium search-query">
	      <button type="submit" class="btn">Search</button>
	    </form>
	    
            <div class="well" id="download">
	      <a href="/pythonorg/default/sync/download">Download Now!</a>
	      (<a href="http://wiki.python.org/moin/Python2orPython3">2.x or 3.x?</a>)
	    </div>
	    
	    
            <div class="well" id="toc"></div>
            <script>
	      jQuery(function(){jQuery('#toc').toc({
	      'selectors': 'h1,h2,h3',
	      'container': '#rst-content',
	      'smoothScrolling': true,
	      'prefix': 'toc',
	      'highlightOnScroll': true,
	      });});
            </script>	    
	    
	    <div class="well" id="python uses">
	      <h3>Using python for</h3>
	      <ul>
		<li>
		  <a href="http://wiki.python.org/moin/WebProgramming">Web</a>
		</li>
		<li>
		  <a href="http://wiki.python.org/moin/DatabaseProgramming">Database</a>
		</li>
		<li>
		  <a href="http://wiki.python.org/moin/GuiProgramming">GUI</a>
		</li>
		<li>
		  <a href="/pythonorg/default/index/about/apps">Networking</a>
		</li>
		<li>
		  <a href="/pythonorg/default/index/about/apps">Science</a>
		</li>
		<li>
		  <a href="/pythonorg/default/index/community/sigs/current/edu-sig">CS Education</a>
		</li>
		<li>
		  <a href="/pythonorg/default/index/about/apps">Games</a>
		</li>
		<li>
		  <a href="/pythonorg/default/index/about/apps">More</a>
		</li>
	      </ul>
	    </div>

<script charset="utf-8" src="http://widgets.twimg.com/j/2/widget.js"></script>
<script>
new TWTR.Widget({
  version: 2,
  type: 'profile',
  rpp: 4,
  interval: 30000,
  width: 'auto',
  height: 300,
  theme: {
    shell: {
      background: '#f2f2f2',
      color: '#ffffff'
    },
    tweets: {
      background: '#ffffff',
      color: '#3686b4',
      links: '#262626'
    }
  },
  features: {
    scrollbar: false,
    loop: false,
    live: false,
    behavior: 'all'
  }
}).render().setUser('ThePSF').start();
</script>
          </div>	
	  
        </div>
      </section><br /><br /><br /><br />
      <!-- footer ================================== -->
      <footer class="footer">
	<span class="auth_navbar"> [ <a href="/pythonorg/default/user/login?_next=/pythonorg/default/sync">Login</a> | <a href="/pythonorg/default/user/retrieve_username?_next=/pythonorg/default/sync">Forgot username?</a> | <a href="/pythonorg/default/user/request_reset_password?_next=/pythonorg/default/sync">Lost password?</a> ] </span>
        <p class="pull-right">
	  Copyright © 1990-2012, Python Software Foundation
          (<a href="/pythonorg/default/sync/about/legal">Legal Statements</a>)
        </p>
      </footer>
    </div>
    <!-- /container -->
    
    <!-- placed at the end of the document so the pages load faster -->
    <script src="/pythonorg/static/js/jquery.quovolver.js"></script>
    <script src="/pythonorg/static/bootswatch_files/bootstrap-dropdown.js"></script>
    <script src="/pythonorg/static/bootswatch_files/bootstrap-scrollspy.js"></script>
    <script src="/pythonorg/static/bootswatch_files/bootstrap-collapse.js"></script>
    <script src="/pythonorg/static/bootswatch_files/bootstrap-tooltip.js"></script>
    <script>
        jQuery(function(){
	  jQuery('.nav>li>a').each(function(){
	    if(jQuery(this).parent().find('ul').length)
	      jQuery(this).attr({'class':'dropdown-toggle','data-toggle':'dropdown'}).append('<b class="caret"></b>');
          });	
        });
      </script>
    <script type="text/javascript" src="/pythonorg/static/js/jquerytypewriter.js"></script>
    <script src="/pythonorg/static/js/share.js?static=%2Fpythonorg%2Fstatic%2Fimages"></script>
    <script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'unknown']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> 
  </body>
</html>
    
